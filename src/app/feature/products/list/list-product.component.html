<app-modal
  [(isOpen)]="showModal"
  [isValid]="validatebutton()"
  (onConfirm)="importResponse() ? onCancel() : onUpload()"
  [title]="importResponse() ? 'Resultado de Importación' : 'Cargar productos desde libro excel'"
  [confirmLabel]="importResponse() ? 'Entendido' : 'Procesar productos'"
  [cancelLabel]="importResponse() ? '' : 'Cancelar'"
  (onCancel)="onCancel()"
>
  <app-button
    btnType="secondary"
    label="Descargar plantilla"
    type="button"
    (btnClick)="download()"
    [icon]="'cloud-download'"
  >
  </app-button>
  <div class="mb-5"></div>
  <div class="p-6 bg-white rounded-3xl max-w-lg">
    <div *ngIf="!importResponse(); else reportTemplate">
      <h2 class="font-display text-2xl font-bold mb-6 text-zinc-900">Importar Productos</h2>
      <div class="space-y-4">
        <label class="block">
          <input
            #fileInput
            type="file"
            (change)="onFileSelected($event)"
            accept=".xlsx, .xls"
            class="block w-full text-sm text-zinc-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-zinc-900 file:text-white hover:file:bg-zinc-800 transition-all cursor-pointer"
          />
        </label>
      </div>
    </div>

    <ng-template #reportTemplate>
      <div class="space-y-6">
        <div class="grid grid-cols-3 gap-3">
          <div class="p-3 bg-green-50 border border-green-100 rounded-2xl text-center">
            <span class="block text-2xl font-bold text-green-700">{{
              importResponse()?.created
            }}</span>
            <span class="text-xs font-semibold text-green-600 uppercase tracking-wider"
              >Creados</span
            >
          </div>
          <div class="p-3 bg-blue-50 border border-blue-100 rounded-2xl text-center">
            <span class="block text-2xl font-bold text-blue-700">{{
              importResponse()?.updated
            }}</span>
            <span class="text-xs font-semibold text-blue-600 uppercase tracking-wider"
              >Editados</span
            >
          </div>
          <div class="p-3 bg-red-50 border border-red-100 rounded-2xl text-center">
            <span class="block text-2xl font-bold text-red-700">{{
              importResponse()?.failed
            }}</span>
            <span class="text-xs font-semibold text-red-600 uppercase tracking-wider"
              >Fallidos</span
            >
          </div>
        </div>

        <div *ngIf="importResponse()?.errorDetails?.length" class="space-y-2">
          <h3 class="text-sm font-bold text-zinc-800 flex items-center gap-2">
            <span class="w-2 h-2 bg-red-500 rounded-full"></span>
            Errores encontrados
          </h3>
          <div class="max-h-32 overflow-y-auto bg-zinc-50 p-3 rounded-xl border border-zinc-100">
            <ul class="text-xs text-zinc-600 space-y-1">
              <li *ngFor="let error of importResponse()?.errorDetails">• {{ error }}</li>
            </ul>
          </div>
        </div>

        <div *ngIf="importResponse()?.warnings?.length" class="space-y-2">
          <h3 class="text-sm font-bold text-zinc-800 flex items-center gap-2">
            <span class="w-2 h-2 bg-amber-500 rounded-full"></span>
            Advertencias
          </h3>
          <div class="max-h-32 overflow-y-auto bg-amber-50 p-3 rounded-xl border border-amber-100">
            <ul class="text-xs text-amber-700 space-y-1">
              <li *ngFor="let warning of importResponse()?.warnings">• {{ warning }}</li>
            </ul>
          </div>
        </div>
      </div>
    </ng-template>
  </div>
</app-modal>

<div class="space-y-6">
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
    <div>
      <h1 class="text-2xl font-bold text-zinc-900">Productos</h1>
      <p class="text-zinc-500 text-sm">Gestiona la información de tus Productos.</p>
    </div>

    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
      <app-button
        label="Subir Excel"
        btnType="blue"
        type="button"
        (btnClick)="formFile()"
        [icon]="'cloud-upload'"
      >
      </app-button>
      <app-button
        label="Registrar producto"
        type="button"
        (btnClick)="add()"
        [icon]="'add-plus'"
      ></app-button>
    </div>
  </div>

  <app-table-list
    [data]="filtered()"
    [columns]="tableColumns"
    [filters]="filters() || []"
    [totalItems]="totalItems()"
    [currentPage]="currentPage()"
    [totalPages]="totlPages()"
    (onAction)="handleTableAction($event)"
    (onFilter)="handleFilter($event)"
    (onSort)="handleSort($event)"
    (onPageChange)="handlePage($event)"
    [searchTerm]="searchQuery()"
    (onSearch)="searchQuery.set($event)"
    (onPageSizeChange)="pageSize.set($event)"
  >
  </app-table-list>
</div>
