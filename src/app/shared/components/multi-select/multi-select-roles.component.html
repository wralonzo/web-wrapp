<div class="relative w-full py-2">
  <label class="text-xs font-bold text-zinc-500 uppercase tracking-widest ml-1 mb-2 block">
    {{ label() }}
  </label>

  <button
    (click)="toggle()"
    type="button"
    class="w-full flex items-center justify-between bg-white border border-zinc-200 p-3 rounded-2xl shadow-sm hover:border-blue-400 transition-all min-h-[52px]"
  >
    <div class="flex flex-wrap gap-1 items-center overflow-hidden">
      @if (selectedRoles().length > 0) {
      <span class="text-sm font-semibold text-zinc-700 truncate max-w-[200px]">
        {{ displayLabel() }}
      </span>
      <span class="bg-blue-100 text-blue-700 text-[10px] px-2 py-0.5 rounded-full font-bold">
        {{ selectedRoles().length }}
      </span>
      } @else {
      <span class="text-zinc-400 text-sm italic">Seleccionar roles...</span>
      }
    </div>

    <svg
      class="w-4 h-4 text-zinc-400 transition-transform"
      [class.rotate-180]="isOpen()"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="m19.5 8.25-7.5 7.5-7.5-7.5"
      />
    </svg>
  </button>

  @if (isOpen()) {
  <div
    class="absolute z-50 w-full mt-2 bg-white border border-zinc-200 rounded-[24px] shadow-2xl p-2 animate-in fade-in slide-in-from-top-2 duration-200"
  >
    <div class="max-h-60 overflow-y-auto space-y-1">
      @for (role of options(); track role.value.toString()) {
      <button
        (click)="toggleRole(role.value.toString())"
        type="button"
        class="w-full flex items-center justify-between p-3 rounded-xl transition-colors group"
        [class.bg-blue-50]="isSelected(role.value.toString())"
        [class.text-blue-700]="isSelected(role.value.toString())"
        [class.hover:bg-zinc-50]="!isSelected(role.value.toString())"
      >
        <span class="text-sm font-medium">{{ role.label }}</span>

        <div
          class="w-5 h-5 rounded-md border flex items-center justify-center transition-all"
          [class.bg-blue-600]="isSelected(role.value.toString())"
          [class.border-blue-600]="isSelected(role.value.toString())"
          [class.border-zinc-300]="!isSelected(role.value.toString())"
        >
          @if (isSelected(role.value.toString())) {
          <svg class="w-3.5 h-3.5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="3"
              d="M5 13l4 4L19 7"
            />
          </svg>
          }
        </div>
      </button>
      }
    </div>
  </div>
  }
</div>
