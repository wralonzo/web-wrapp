<div class="min-h-screen bg-bg-secondary font-sans text-text-primary transition-colors duration-300">

    <!-- Main Header Area -->
    <div
        class="text-center py-12 px-4 shadow-sm relative overflow-hidden bg-gradient-to-b from-bg-primary to-bg-secondary">
        <h1 class="text-3xl md:text-5xl font-black text-text-primary mb-4">Agenda tu Momento de Belleza</h1>
        <p class="text-text-secondary font-medium max-w-2xl mx-auto text-sm md:text-base">
            Reserva tu cita en línea de forma rápida y sencilla. Elige tu servicio,<br class="hidden md:block">
            profesional y horario ideal.
        </p>
    </div>

    <!-- Main Content Grid -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-20">
        <form [formGroup]="bookingForm" (ngSubmit)="onSubmit()" class="grid grid-cols-1 lg:grid-cols-12 gap-8">


            <!-- Left Column: Steps (8 cols) -->
            <div class="lg:col-span-8 flex flex-col gap-6">

                <!-- Step 1: Sucursal -->
                <div class="bg-bg-primary rounded-3xl p-6 md:p-8 shadow-sm border border-border">
                    <div class="flex items-center gap-4 mb-6">
                        <span
                            class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-bold shadow-sm shadow-primary/40">1</span>
                        <h2 class="text-xl font-black text-text-primary">Selecciona tu Sucursal</h2>
                    </div>

                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </div>
                        <select formControlName="branchId"
                            class="w-full pl-12 pr-10 py-4 bg-bg-secondary border-none rounded-2xl text-text-secondary font-bold focus:ring-2 focus:ring-primary/40 appearance-none cursor-pointer outline-none">
                            <option *ngFor="let branch of branches" [value]="branch.id">{{branch.name}}</option>
                        </select>
                        <div
                            class="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none text-gray-400">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Servicios -->
                <div class="bg-bg-primary rounded-3xl p-6 md:p-8 shadow-sm border border-border">
                    <div class="flex items-center gap-4 mb-6">
                        <span
                            class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-bold shadow-sm shadow-primary/40">2</span>
                        <h2 class="text-xl font-black text-text-primary">Elige un Servicio</h2>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div *ngFor="let s of services" (click)="selectService(s.id)"
                            class="relative flex flex-col items-center justify-center p-6 rounded-2xl border-2 transition-all cursor-pointer bg-bg-primary group"
                            [ngClass]="bookingForm.get('serviceId')?.value === s.id ? 'border-primary shadow-md shadow-primary/10' : 'border-border hover:border-gray-200 hover:shadow-sm dark:hover:border-gray-600'">

                            <!-- Simple SVG icons placeholder -->
                            <div class="w-12 h-12 mb-3 rounded-full flex items-center justify-center transition-colors"
                                [ngClass]="bookingForm.get('serviceId')?.value === s.id ? 'bg-primary/10 text-primary' : 'bg-bg-secondary text-text-muted group-hover:bg-gray-100 dark:group-hover:bg-gray-800'">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <circle cx="12" cy="12" r="10" stroke-width="2"></circle>
                                </svg>
                            </div>
                            <span class="font-bold text-sm"
                                [ngClass]="bookingForm.get('serviceId')?.value === s.id ? 'text-primary' : 'text-text-primary'">
                                {{s.name}}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Profesional -->
                <div class="bg-bg-primary rounded-3xl p-6 md:p-8 shadow-sm border border-border">
                    <div class="flex items-center gap-4 mb-6">
                        <span
                            class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-bold shadow-sm shadow-primary/40">3</span>
                        <h2 class="text-xl font-black text-text-primary">Selecciona Profesional</h2>
                    </div>

                    <div class="flex flex-wrap gap-8">
                        <div *ngFor="let st of stylists" (click)="selectStylist(st.id)"
                            class="flex flex-col items-center cursor-pointer group">

                            <div class="relative w-20 h-20 rounded-full transition-all duration-300 p-1 mb-3"
                                [ngClass]="bookingForm.get('stylistId')?.value === st.id ? 'bg-gradient-to-tr from-primary to-primary-hover' : 'bg-transparent group-hover:bg-bg-secondary'">
                                <div class="w-full h-full rounded-full bg-bg-primary p-0.5 relative overflow-hidden">
                                    <img [src]="st.avatarUrl" [alt]="st.name"
                                        class="w-full h-full object-cover rounded-full bg-gray-100"
                                        onerror="this.src='https://ui-avatars.com/api/?name='+st.name+'&background=f8f9fa&color=a0aec0'">
                                </div>
                                <!-- Check badge -->
                                <div *ngIf="bookingForm.get('stylistId')?.value === st.id"
                                    class="absolute bottom-0 right-0 w-6 h-6 bg-primary border-2 border-bg-primary rounded-full flex items-center justify-center text-white shadow-sm">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                            d="M5 13l4 4L19 7" />
                                    </svg>
                                </div>
                            </div>

                            <span class="font-bold text-sm text-text-primary">{{st.name}}</span>
                            <span class="text-xs font-medium text-text-muted mt-0.5">{{st.role}}</span>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Fecha y Horario -->
                <div class="bg-bg-primary rounded-3xl p-6 md:p-8 shadow-sm border border-border">
                    <div class="flex items-center gap-4 mb-6">
                        <span
                            class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-bold shadow-sm shadow-primary/40">4</span>
                        <h2 class="text-xl font-black text-text-primary">Fecha y Horario</h2>
                    </div>

                    <div class="flex flex-col lg:flex-row gap-8">
                        <!-- Calendario Simple -->
                        <div class="flex-1 bg-bg-secondary rounded-3xl p-6">
                            <div class="flex justify-between items-center mb-6">
                                <span class="font-bold text-text-primary">{{currentMonth}}</span>
                                <div class="flex gap-2">
                                    <button type="button"
                                        class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-bg-primary transition-colors text-text-secondary"><svg
                                            class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                                        </svg></button>
                                    <button type="button"
                                        class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-bg-primary transition-colors text-text-secondary"><svg
                                            class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                                        </svg></button>
                                </div>
                            </div>

                            <div class="grid grid-cols-7 gap-y-4 gap-x-1 text-center mb-4">
                                <div class="text-xs font-black text-text-muted uppercase">Lu</div>
                                <div class="text-xs font-black text-text-muted uppercase">Ma</div>
                                <div class="text-xs font-black text-text-muted uppercase">Mi</div>
                                <div class="text-xs font-black text-text-muted uppercase">Ju</div>
                                <div class="text-xs font-black text-text-muted uppercase">Vi</div>
                                <div class="text-xs font-black text-text-muted uppercase">Sa</div>
                                <div class="text-xs font-black text-text-muted uppercase">Do</div>

                                <ng-container *ngFor="let day of calendarDays">
                                    <div (click)="selectDay(day.date, day.inactive)"
                                        class="w-8 h-8 mx-auto rounded-full flex items-center justify-center text-sm font-bold transition-all cursor-pointer"
                                        [ngClass]="{
                            'text-text-muted font-medium cursor-default opacity-50': day.inactive,
                            'bg-primary text-white shadow-md shadow-primary/40': day.selected,
                            'text-text-primary hover:bg-bg-primary': !day.inactive && !day.selected
                         }">
                                        {{day.date}}
                                    </div>
                                </ng-container>
                            </div>
                        </div>

                        <!-- Horarios -->
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-6">
                                <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <span class="font-bold text-sm text-text-primary">Horarios Disponibles</span>
                            </div>

                            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 gap-3">
                                <button type="button" *ngFor="let time of availableTimes" (click)="selectTime(time)"
                                    class="py-3 px-2 rounded-xl text-sm font-bold border-2 transition-all"
                                    [ngClass]="bookingForm.get('time')?.value === time ? 'border-primary text-primary bg-primary/5 shadow-sm shadow-primary/10' : 'border-border text-text-secondary bg-bg-primary hover:border-text-muted hover:bg-bg-secondary'">
                                    {{time}}
                                </button>
                                <div
                                    class="py-3 px-2 rounded-xl text-sm font-medium border-2 border-transparent text-text-muted bg-transparent cursor-not-allowed opacity-50">
                                    06:30 PM
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Right Column: Summary (4 cols, Sticky) -->
            <div class="lg:col-span-4 relative">
                <div class="sticky top-28 flex flex-col gap-6">

                    <!-- Resumen Card -->
                    <div
                        class="bg-bg-primary rounded-3xl shadow-lg shadow-primary/5 border border-border overflow-hidden">
                        <div class="bg-primary p-6 text-white text-center">
                            <h3 class="text-xl font-black mb-1">Resumen de Cita</h3>
                            <p class="text-white/80 text-xs italic font-medium">Revisa los detalles antes de confirmar
                            </p>
                        </div>

                        <div class="p-6 md:p-8 space-y-6">
                            <!-- Servicio -->
                            <div class="flex items-start gap-4">
                                <div
                                    class="w-8 h-8 rounded-full bg-bg-secondary flex items-center justify-center text-text-muted shrink-0">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <circle cx="12" cy="12" r="10" stroke-width="2"></circle>
                                    </svg>
                                </div>
                                <div class="flex flex-col flex-1">
                                    <span
                                        class="text-[10px] uppercase font-black tracking-widest text-text-muted mb-1">Servicio</span>
                                    <span class="font-bold text-text-primary leading-tight mb-1">{{
                                        selectedService?.name ||
                                        'No seleccionado' }}</span>
                                    <span class="text-primary font-black text-sm">${{ (selectedService?.price || 0) |
                                        number:'1.2-2' }}</span>
                                </div>
                            </div>

                            <hr class="border-border">

                            <!-- Estilista -->
                            <div class="flex items-start gap-4">
                                <div
                                    class="w-8 h-8 rounded-full bg-bg-secondary flex items-center justify-center text-text-muted shrink-0">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                </div>
                                <div class="flex flex-col">
                                    <span
                                        class="text-[10px] uppercase font-black tracking-widest text-text-muted mb-1">Estilista</span>
                                    <span class="font-bold text-text-primary leading-tight">{{ selectedStylist?.name ||
                                        'No
                                        seleccionado' }}</span>
                                </div>
                            </div>

                            <hr class="border-border">

                            <!-- Fecha y Hora -->
                            <div class="flex items-start gap-4">
                                <div
                                    class="w-8 h-8 rounded-full bg-bg-secondary flex items-center justify-center text-text-muted shrink-0">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                    </svg>
                                </div>
                                <div class="flex flex-col">
                                    <span
                                        class="text-[10px] uppercase font-black tracking-widest text-text-muted mb-1">Fecha
                                        y Hora</span>
                                    <span class="font-bold text-text-primary leading-tight mb-1">{{
                                        bookingForm.get('date')?.value | date:'EEEE, dd MMMM' }}</span>
                                    <span class="text-sm font-medium text-text-secondary">{{
                                        bookingForm.get('time')?.value ||
                                        '--:--' }}</span>
                                </div>
                            </div>

                            <!-- Action Button -->
                            <div class="pt-4">
                                <button type="submit" [disabled]="!bookingForm.valid"
                                    class="w-full py-4 bg-primary hover:bg-primary-hover disabled:bg-text-muted disabled:cursor-not-allowed text-white font-bold rounded-2xl shadow-lg shadow-primary/30 transition-all flex justify-center items-center gap-2">
                                    Confirmar Cita
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M14 5l7 7m0 0l-7 7m7-7H3" />
                                    </svg>
                                </button>
                                <p class="text-center text-[10px] text-text-muted mt-4 leading-relaxed px-4">
                                    Al confirmar, aceptas nuestras politicas de cancelacion y terminos de servicio.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Rewards Card -->
                    <div class="bg-bg-primary rounded-3xl p-6 shadow-lg border border-border overflow-hidden relative">
                        <div class="absolute top-0 right-0 p-4">
                            <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                            </svg>
                        </div>
                        <h4 class="text-text-primary font-bold text-sm mb-1">Beleya Rewards</h4>
                        <p class="text-[10px] text-text-muted italic mb-4">Cliente VIP</p>

                        <div class="w-full h-1.5 bg-bg-secondary rounded-full overflow-hidden mb-3">
                            <div class="h-full bg-gradient-to-r from-primary to-primary-hover rounded-full"
                                style="width: 70%"></div>
                        </div>
                        <p class="text-[10px] text-text-muted">Faltan 2 servicios para tu pròximo descuento</p>
                    </div>

                </div>
            </div>
        </form>
    </div>
</div>